<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.0.7/css/boxicons.min.css">
<link rel="stylesheet" href="../static/styles.css" />
<title>Edicion de Plantas</title>

</head>
<body class="editp">

  <header class="barra-sup"> 
    <a href="Admin.html" id="Titulo" class="Titulo">EcoMapeoBotánico</a>
    <button type="button" class="back"><a class="regre" href="Admin.html"><i class='bx bx-arrow-back'></i></a></button>
    <button type="button" class="cerrar-sesion" onclick="cerrarSesion()"><i class='bx bx-log-out'></i></button>
</header>

  <h1 class="tit-form">Formulario de Plantas</h1>

  <button class="editinv" id="editarInvestigacionesBtn">Editar investigaciones</button>

  <form class="formulario" action="editplanta.php" method="POST" enctype="multipart/form-data">
    <label for="nombre">Nombre:</label><br>
    <input type="text" id="nombre" name="nombre" class="limitedcin" required><br><br>

    <label for="nombre_cientifico">Nombre Científico:</label><br>
    <input type="text" id="nombre_cientifico" name="nombre_cientifico" class="limitedcin" required><br><br>

    <label for="reino">Reino:</label><br>
    <input type="text" id="reino" name="reino" class="limitedcin" required><br><br>

    <label for="division">División:</label><br>
    <input type="text" id="division" name="division" class="limitedcin" required><br><br>

    <label for="SubDivision">Subdivisión:</label><br>
    <input type="text" id="SubDivision" name="SubDivision" class="limitedcin" required><br><br>

    <label for="clase">Clase:</label><br>
    <input type="text" id="clase" name="clase" class="limitedcin" required><br><br>

    <label for="SubClase">Subclase:</label><br>
    <input type="text" id="SubClase" name="SubClase" class="limitedcin" required><br><br>

    <label for="orden">Orden:</label><br>
    <input type="text" id="orden" name="orden" class="limitedcin" required><br><br>

    <label for="familia">Familia:</label><br>
    <input type="text" id="familia" name="familia" class="limitedcin" required><br><br>

    <label for="genero">Género:</label><br>
    <input type="text" id="genero" name="genero" class="limitedcin" required><br><br>

    <label for="especie">Especie:</label><br>
    <input type="text" id="especie" name="especie" class="limitedcin" required><br><br>

    <label for="ciudad">Ciudad:</label><br>
    <input type="text" id="ciudad" name="ciudad" class="limitedcin" required><br><br>

    <label for="direccion">Dirección:</label><br>
    <input type="text" id="direccion" name="direccion" class="limitedcin" required><br><br>

    <label for="zona_reserva">Nombre de la Zona de Reserva:</label><br>
    <input type="text" id="zona_reserva" name="zona_reserva" class="limitedcin" required><br><br>

    <label for="ubicacion">Ubicación:</label><br>
    <input type="text" id="ubicacion" name="ubicacion" class="limitedcin" required><br><br>

    <label for="jardin_botanico">Nombre del Jardín Botánico:</label><br>
    <input type="text" id="jardin_botanico" name="jardin_botanico" class="limitedcin" required><br><br>

    <label for="superficie_decimal">Superficie Decimal:</label><br>
    <input type="number" id="superficie_decimal" name="superficie_decimal" class="limitedcin" required><br><br>

    <label for="inicio_flora">Inicio de la Flora:</label><br>
    <input type="text" id="inicio_flora" name="inicio_flora" class="limitedcin" required><br><br>

    <label for="fin_flora">Fin de la Flora:</label><br>
    <input type="text" id="fin_flora" name="fin_flora" class="limitedcin" required><br><br>

    <label for="tipo_cuidado">Tipo de Cuidado:</label><br>
    <input type="text" id="tipo_cuidado" name="tipo_cuidado" class="limitedcin" required><br><br>

    <label for="informacion">Recomendaciones de cuidado:</label><br>
    <textarea  oninput="validarASCII(this)" rows="4" cols="50" id="informacion" name="informacion" class="limited" required></textarea><br><br>

    <h2 class="subt-form">Plagas</h2>

    <label for="tipo_plaga">Tipo de Plaga:</label><br>
    <input type="text" id="tipo_plaga" name="tipo_plaga" class="limitedcin" ><br><br>

    <label for="descripcion_plaga">Descripción de la Plaga:</label><br>
    <textarea oninput="validarASCII(this)" rows="4" cols="50" id="descripcion_plaga" name="descripcion_plaga" class="limited"></textarea><br>

    <h2 class="subt-form">Información Climática</h2>

    <label for="ciudad_clima">Ciudad:</label><br>
    <input type="text" id="ciudad_clima" name="ciudad_clima" class="limitedcin" required><br><br>

    <label for="descripcion_clima">Descripción del Clima:</label><br>
    <textarea oninput="validarASCII(this)" rows="4" cols="50" id="descripcion_clima" name="descripcion_clima" class="limited" required></textarea><br><br>

    <label for="temperatura_promedio">Temperatura Promedio:</label><br>
    <input type="number" id="temperatura_promedio" name="temperatura_promedio" class="limitedcin" required><br><br>

    <label for="humedad_promedio">Humedad Promedio:</label><br>
    <input type="number" id="humedad_promedio" name="humedad_promedio" class="limitedcin" required><br><br>

    <label for="descripcion_suelo">Descripción del Suelo:</label><br>
    <textarea oninput="validarASCII(this)" rows="4" cols="50" id="descripcion_suelo" name="descripcion_suelo" class="limited" required></textarea><br><br>

    <label for="latitud">Latitud:</label><br>
    <input type="text" id="latitud" name="latitud" class="limitedcin" required><br><br>
    <label for="longitud">Longitud:</label><br>
    <input type="text" id="longitud" name="longitud" class="limitedcin" required><br><br>

    <label for="imagen">Subir Imagen:</label><br>
    <input type="file" id="imagen" name="imagen" accept="image/*"><br><br>

    

    <input type="hidden" name="id_planta" id="id_planta">
    <button class="enviar" type="submit" value="Enviar" onclick="return confirmarEdicion();">Enviar


  </form>


<script src="verificar_sesion.js"></script>

<script>

document.addEventListener('DOMContentLoaded', function () {
    var editarInvestigacionesBtn = document.getElementById('editarInvestigacionesBtn');

    editarInvestigacionesBtn.addEventListener('click', function () {
        // Obtener el ID de la planta desde los parámetros de la URL
        var urlParams = new URLSearchParams(window.location.search);
        var idPlanta = urlParams.get('id');

        // Verificar que el ID de la planta no esté vacío o sea inválido antes de proceder
        if (idPlanta) {
            console.log('ID de planta obtenido:', idPlanta); // Para depuración

            // Construir la URL de la página de edición con el ID de la planta como parámetro
            var url = "editinvesadm.html?id=" + idPlanta;

            // Redirigir a la página de edición de investigaciones
            window.location.href = url;
        } else {
            alert("No se encontró ID de planta válido en la URL.");
        }
    });
});





    // Función para eliminar la cookie y cerrar sesión
    function cerrarSesion() {
        eliminarCookie('email');
        // Redirige al usuario a la página de inicio de sesión (login.html)
        window.location.href = "../LoginAdm/login.html";
    }

    // Función para eliminar la cookie
    function eliminarCookie(nombre) {
        // Establecer el tiempo de expiración de la cookie en el pasado para eliminarla
        document.cookie = nombre + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
    }

   function confirmarEdicion() {
    // Mostrar un cuadro de diálogo de confirmación al usuario
    var confirmacion = confirm("¿Estás seguro de editar esta planta?");
    
    // Si el usuario confirma, devuelve true y se envía el formulario
    // Si el usuario cancela, devuelve false y el envío del formulario se cancela
    return confirmacion;
  }

  // Asignar la función confirmarEdicion() al evento submit del formulario
  window.onload = function() {
    var editForm = document.getElementById('editForm');
    if (editForm) {
      editForm.onsubmit = function() {
        console.log("Evento submit del formulario activado");
        return confirmarEdicion();
      };
    }
  };
function validarUTF8(input) {
    var regex = /^[ -~áéíóúÁÉÍÓÚüÜ,.ñÑ]*$/; // Esta expresión regular acepta caracteres ASCII imprimibles, letras con tilde, coma, punto, la letra ñ y caracteres UTF-8 adicionales
    if (!regex.test(input.value)) {
        input.value = input.value.replace(/[^\x20-\x7EáéíóúÁÉÍÓÚüÜ,.ñÑ]/g, ''); // Elimina caracteres no permitidos
        input.value = input.value.replace(/[\'\"]+/g, ''); // Elimina comillas simples y dobles
    }
}



  document.addEventListener('DOMContentLoaded', function() {
    var descripciones = document.querySelectorAll('textarea.limited');
    
    descripciones.forEach(function(textarea) {
      var contador = document.createElement('span');
      contador.textContent = '0';
      textarea.parentNode.insertBefore(contador, textarea.nextSibling);

      textarea.addEventListener('input', function() {
        if (textarea.value.length > 500) {
          textarea.value = textarea.value.substring(0, 500);
        }
        contador.textContent = textarea.value.length;
      });
    });
  });

document.addEventListener('DOMContentLoaded', function() {
    // Seleccionar todos los elementos con la clase 'limitedcin'
    var elementos = document.querySelectorAll('.limitedcin');

    // Iterar sobre cada elemento y aplicar la limitación de caracteres
    elementos.forEach(function(elemento) {
        elemento.addEventListener('input', function() {
            // Limitar el texto a 50 caracteres
            if (this.value.length > 50) {
                this.value = this.value.substring(0, 50);
            }
        });
    });
});


</script>

  <script>
    function getUrlParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    // Obtener el ID de la planta de la URL
    const idPlanta = getUrlParam('id');

    // Asignar el ID de la planta al campo oculto en el formulario
    document.getElementById('id_planta').value = idPlanta;


    document.addEventListener('DOMContentLoaded', function() {
    window.onload = function() {
        // Obtener el ID de la planta de la URL
        var urlParams = new URLSearchParams(window.location.search);
        var idPlanta = urlParams.get('id');
        console.log('ID de la planta seleccionada:', idPlanta);

        // Realizar la solicitud AJAX para obtener los datos de la planta seleccionada
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {

            if (this.readyState == 4 && this.status == 200) {
              
                var plantaData = JSON.parse(this.responseText);
                // Llenar los campos del formulario con los datos de la planta
                document.getElementById("nombre").value = plantaData.Nombrep;
                document.getElementById("nombre_cientifico").value = plantaData.Nombre_cientifico;
                document.getElementById("reino").value = plantaData.reino;
                document.getElementById("division").value = plantaData.division;
                document.getElementById("SubDivision").value = plantaData.subdivision;
                document.getElementById("clase").value = plantaData.clase;
                document.getElementById("SubClase").value = plantaData.subclase;
                document.getElementById("orden").value = plantaData.orden;
                document.getElementById("familia").value = plantaData.familia;
                document.getElementById("genero").value = plantaData.genero;
                document.getElementById("especie").value = plantaData.especie;
                document.getElementById("ciudad").value = plantaData.Ciudad;
                document.getElementById("direccion").value = plantaData.Direccion;
                document.getElementById("zona_reserva").value = plantaData.nombrez;
                document.getElementById("ubicacion").value = plantaData.ubicacion;
                document.getElementById("jardin_botanico").value = plantaData.nombrej;
                document.getElementById("superficie_decimal").value = plantaData.superficie;
                document.getElementById("inicio_flora").value = plantaData.inicio_flora;
                document.getElementById("fin_flora").value = plantaData.fin_flora;
                document.getElementById("tipo_cuidado").value = plantaData.tipo_cuidado;
                document.getElementById("informacion").value = plantaData.INFORMACION;
                document.getElementById("tipo_plaga").value = plantaData.TIPO;
                document.getElementById("descripcion_plaga").value = plantaData.Descripcion;
                document.getElementById("ciudad_clima").value = plantaData.nombrec;
                document.getElementById("descripcion_clima").value = plantaData.descripcionc;
                document.getElementById("temperatura_promedio").value = plantaData.temperatura_promedio;
                document.getElementById("humedad_promedio").value = plantaData.humedad_promedio;
                document.getElementById("descripcion_suelo").value = plantaData.Descripcions;
                document.getElementById("latitud").value = plantaData.latitud;
                document.getElementById("longitud").value = plantaData.longitud;
                console.log('Datos de la planta:', plantaData);
            }
            
        };

        xhttp.open("GET", "cargar_datos_planta.php?id=" + idPlanta, true);
        

        xhttp.send();
    };
});
</script>


</body>
</html>


